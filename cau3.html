<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω S√°ch</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="browser-frame">
    <div class="browser-header">
        <div class="nav-buttons">
            <button class="nav-btn">‚Üê</button>
            <button class="nav-btn">‚Üí</button>
            <button class="nav-btn">‚úï</button>
            <button class="nav-btn">üè†</button>
        </div>
        <input type="text" class="url-bar" value="http://quanlisach.com" readonly>
        <button class="search-btn">üîç</button>
    </div>

    <div class="content">
        <h1>Qu·∫£n l√≠ s√°ch</h1>

        <table id="bookTable">
            <thead>
            <tr>
                <th>M√£ s·ªë s√°ch</th>
                <th>T√™n s√°ch</th>
                <th>NƒÉm xu·∫•t b·∫£n</th>
                <th>S·ªë quy·ªÉn</th>
                <th>T√¨nh tr·∫°ng</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
            </thead>
            <tbody id="bookTableBody">
            </tbody>
        </table>

        <div class="button-group">
            <button class="btn" id="addExistingBtn">Th√™m s√°ch ƒë√£ c√≥</button>
            <button class="btn" id="addNewBtn">Th√™m s√°ch m·ªõi</button>
            <button class="btn" id="borrowBtn">M∆∞·ª£n s√°ch</button>
            <button class="btn" id="showMostBtn">Hi·ªÉn th·ªã s√°ch nhi·ªÅu nh·∫•t</button>
        </div>
    </div>
</div>

<div class="modal" id="addNewModal">
    <div class="modal-content">
        <div class="modal-header">Th√™m s√°ch m·ªõi</div>
        <form id="addNewForm">
            <div class="form-group">
                <label>M√£ s·ªë s√°ch:</label>
                <input type="text" id="newBookId" maxlength="5" placeholder="Vd: 12345">
                <div class="error-message" id="newBookIdError">M√£ s√°ch ph·∫£i c√≥ 5 k√Ω t·ª±, k√Ω t·ª± ƒë·∫ßu t·ª´ 1-5, 4 k√Ω t·ª± sau t·ª´ 0-9</div>
            </div>
            <div class="form-group">
                <label>T√™n s√°ch:</label>
                <input type="text" id="newBookName" placeholder="Nh·∫≠p t√™n s√°ch">
                <div class="error-message" id="newBookNameError">T√™n s√°ch kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng</div>
            </div>
            <div class="form-group">
                <label>NƒÉm xu·∫•t b·∫£n:</label>
                <input type="text" id="newBookYear" maxlength="4" placeholder="Vd: 2000">
                <div class="error-message" id="newBookYearError">NƒÉm xu·∫•t b·∫£n ph·∫£i c√≥ 4 ch·ªØ s·ªë</div>
            </div>
            <div class="form-group">
                <label>S·ªë quy·ªÉn:</label>
                <input type="number" id="newBookQuantity" min="1" placeholder="Nh·∫≠p s·ªë quy·ªÉn">
                <div class="error-message" id="newBookQuantityError">S·ªë quy·ªÉn ph·∫£i l·ªõn h∆°n 0</div>
            </div>
            <div class="modal-buttons">
                <button type="submit" class="btn">Th√™m</button>
                <button type="button" class="btn" id="cancelNewBtn">H·ªßy</button>
            </div>
        </form>
    </div>
</div>

<div class="modal" id="addExistingModal">
    <div class="modal-content">
        <div class="modal-header">Th√™m s√°ch ƒë√£ c√≥</div>
        <form id="addExistingForm">
            <div class="form-group">
                <label>M√£ s·ªë s√°ch:</label>
                <input type="text" id="existingBookId" maxlength="5" placeholder="Nh·∫≠p m√£ s√°ch">
                <div class="error-message" id="existingBookIdError">M√£ s√°ch kh√¥ng t·ªìn t·∫°i</div>
            </div>
            <div class="form-group">
                <label>S·ªë quy·ªÉn th√™m:</label>
                <input type="number" id="existingBookQuantity" min="1" placeholder="Nh·∫≠p s·ªë quy·ªÉn">
                <div class="error-message" id="existingBookQuantityError">S·ªë quy·ªÉn ph·∫£i l·ªõn h∆°n 0</div>
            </div>
            <div class="modal-buttons">
                <button type="submit" class="btn">Th√™m</button>
                <button type="button" class="btn" id="cancelExistingBtn">H·ªßy</button>
            </div>
        </form>
    </div>
</div>

<div class="modal" id="borrowModal">
    <div class="modal-content">
        <div class="modal-header">M∆∞·ª£n s√°ch</div>
        <form id="borrowForm">
            <div class="form-group">
                <label>M√£ s·ªë s√°ch:</label>
                <input type="text" id="borrowBookId" maxlength="5" placeholder="Nh·∫≠p m√£ s√°ch">
                <div class="error-message" id="borrowBookIdError">M√£ s√°ch kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ h·∫øt</div>
            </div>
            <div class="form-group">
                <label>S·ªë quy·ªÉn m∆∞·ª£n:</label>
                <input type="number" id="borrowQuantity" min="1" placeholder="Nh·∫≠p s·ªë quy·ªÉn">
                <div class="error-message" id="borrowQuantityError">S·ªë quy·ªÉn kh√¥ng h·ª£p l·ªá</div>
            </div>
            <div class="modal-buttons">
                <button type="submit" class="btn">M∆∞·ª£n</button>
                <button type="button" class="btn" id="cancelBorrowBtn">H·ªßy</button>
            </div>
        </form>
    </div>
</div>

<script>
    class Book {
        constructor(id, name, year, quantity) {
            this.id = id;
            this.name = name;
            this.year = year;
            this.quantity = quantity;
            this.status = quantity > 0;
        }

        updateStatus() {
            this.status = this.quantity > 0;
        }

        addQuantity(amount) {
            this.quantity += amount;
            this.updateStatus();
        }

        borrowQuantity(amount) {
            if (this.quantity >= amount) {
                this.quantity -= amount;
                this.updateStatus();
                return true;
            }
            return false;
        }
    }

    class BookManagement {
        constructor() {
            this.books = [
                new Book('12345', 'To√°n', '2000', 3),
                new Book('23456', 'VƒÉn', '1998', 4),
                new Book('37456', 'Ti·∫øng Anh', '1999', 5)
            ];
            this.initializeEvents();
            this.renderTable();
        }

        initializeEvents() {
            document.getElementById('addNewBtn').addEventListener('click', () => this.openAddNewModal());
            document.getElementById('addExistingBtn').addEventListener('click', () => this.openAddExistingModal());
            document.getElementById('borrowBtn').addEventListener('click', () => this.openBorrowModal());
            document.getElementById('showMostBtn').addEventListener('click', () => this.showMostBooks());

            document.getElementById('cancelNewBtn').addEventListener('click', () => this.closeModal('addNewModal'));
            document.getElementById('cancelExistingBtn').addEventListener('click', () => this.closeModal('addExistingModal'));
            document.getElementById('cancelBorrowBtn').addEventListener('click', () => this.closeModal('borrowModal'));

            document.getElementById('addNewForm').addEventListener('submit', (e) => this.handleAddNew(e));
            document.getElementById('addExistingForm').addEventListener('submit', (e) => this.handleAddExisting(e));
            document.getElementById('borrowForm').addEventListener('submit', (e) => this.handleBorrow(e));

            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        this.closeModal(modal.id);
                    }
                });
            });
        }

        renderTable() {
            const tbody = document.getElementById('bookTableBody');
            tbody.innerHTML = '';

            this.books.forEach(book => {
                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>${book.id}</td>
                        <td>${book.name}</td>
                        <td>${book.year}</td>
                        <td>${book.quantity}</td>
                        <td class="${book.status ? 'status-true' : 'status-false'}">
                            ${book.status ? 'True' : 'False'}
                        </td>
                        <td>
                            <button class="action-btn" onclick="bookManagement.deleteBook('${book.id}')">X√≥a</button>
                        </td>
                    `;
                tbody.appendChild(row);
            });
        }

        validateBookId(id) {
            if (id.length !== 5) return false;
            const firstChar = parseInt(id[0]);
            if (firstChar < 1 || firstChar > 5) return false;
            for (let i = 1; i < 5; i++) {
                if (!/\d/.test(id[i])) return false;
            }
            return true;
        }

        validateYear(year) {
            return /^\d{4}$/.test(year);
        }

        showError(elementId, show = true) {
            const element = document.getElementById(elementId);
            if (show) {
                element.classList.add('active');
                element.previousElementSibling.classList.add('error');
            } else {
                element.classList.remove('active');
                element.previousElementSibling.classList.remove('error');
            }
        }

        openAddNewModal() {
            document.getElementById('addNewModal').classList.add('active');
            document.getElementById('addNewForm').reset();
            this.clearErrors('new');
        }

        openAddExistingModal() {
            document.getElementById('addExistingModal').classList.add('active');
            document.getElementById('addExistingForm').reset();
            this.clearErrors('existing');
        }

        openBorrowModal() {
            document.getElementById('borrowModal').classList.add('active');
            document.getElementById('borrowForm').reset();
            this.clearErrors('borrow');
        }

        closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        clearErrors(type) {
            const prefixes = {
                'new': ['newBookId', 'newBookName', 'newBookYear', 'newBookQuantity'],
                'existing': ['existingBookId', 'existingBookQuantity'],
                'borrow': ['borrowBookId', 'borrowQuantity']
            };

            prefixes[type].forEach(prefix => {
                this.showError(prefix + 'Error', false);
            });
        }

        handleAddNew(e) {
            e.preventDefault();
            this.clearErrors('new');

            const id = document.getElementById('newBookId').value.trim();
            const name = document.getElementById('newBookName').value.trim();
            const year = document.getElementById('newBookYear').value.trim();
            const quantity = parseInt(document.getElementById('newBookQuantity').value);

            let hasError = false;

            if (!this.validateBookId(id)) {
                this.showError('newBookIdError');
                hasError = true;
            }

            if (!name) {
                this.showError('newBookNameError');
                hasError = true;
            }

            if (!this.validateYear(year)) {
                this.showError('newBookYearError');
                hasError = true;
            }

            if (isNaN(quantity) || quantity <= 0) {
                this.showError('newBookQuantityError');
                hasError = true;
            }

            if (this.books.find(b => b.id === id)) {
                this.showError('newBookIdError');
                document.getElementById('newBookIdError').textContent = 'M√£ s√°ch ƒë√£ t·ªìn t·∫°i';
                hasError = true;
            }

            if (hasError) return;

            this.books.push(new Book(id, name, year, quantity));
            this.renderTable();
            this.closeModal('addNewModal');
            alert('Th√™m s√°ch m·ªõi th√†nh c√¥ng!');
        }

        handleAddExisting(e) {
            e.preventDefault();
            this.clearErrors('existing');

            const id = document.getElementById('existingBookId').value.trim();
            const quantity = parseInt(document.getElementById('existingBookQuantity').value);

            let hasError = false;

            const book = this.books.find(b => b.id === id);
            if (!book) {
                this.showError('existingBookIdError');
                hasError = true;
            }

            if (isNaN(quantity) || quantity <= 0) {
                this.showError('existingBookQuantityError');
                hasError = true;
            }

            if (hasError) return;

            book.addQuantity(quantity);
            this.renderTable();
            this.closeModal('addExistingModal');
            alert(`ƒê√£ th√™m ${quantity} quy·ªÉn s√°ch "${book.name}"`);
        }

        handleBorrow(e) {
            e.preventDefault();
            this.clearErrors('borrow');

            const id = document.getElementById('borrowBookId').value.trim();
            const quantity = parseInt(document.getElementById('borrowQuantity').value);

            let hasError = false;

            const book = this.books.find(b => b.id === id);
            if (!book || !book.status) {
                this.showError('borrowBookIdError');
                hasError = true;
            }

            if (isNaN(quantity) || quantity <= 0) {
                this.showError('borrowQuantityError');
                hasError = true;
            } else if (book && quantity > book.quantity) {
                this.showError('borrowQuantityError');
                document.getElementById('borrowQuantityError').textContent =
                    `Ch·ªâ c√≤n ${book.quantity} quy·ªÉn`;
                hasError = true;
            }

            if (hasError) return;

            book.borrowQuantity(quantity);
            this.renderTable();
            this.closeModal('borrowModal');
            alert(`ƒê√£ m∆∞·ª£n ${quantity} quy·ªÉn s√°ch "${book.name}"`);
        }

        deleteBook(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s√°ch n√†y?')) {
                this.books = this.books.filter(b => b.id !== id);
                this.renderTable();
                alert('ƒê√£ x√≥a s√°ch th√†nh c√¥ng!');
            }
        }

        showMostBooks() {
            if (this.books.length === 0) {
                alert('Kh√¥ng c√≥ s√°ch n√†o trong danh s√°ch');
                return;
            }

            const maxQuantity = Math.max(...this.books.map(b => b.quantity));
            const mostBooks = this.books.filter(b => b.quantity === maxQuantity);

            let message = `S√°ch c√≥ s·ªë quy·ªÉn nhi·ªÅu nh·∫•t (${maxQuantity} quy·ªÉn):\n\n`;
            mostBooks.forEach(book => {
                message += `- ${book.name} (M√£: ${book.id})\n`;
            });

            alert(message);
        }
    }

    const bookManagement = new BookManagement();
</script>
</body>
</html>